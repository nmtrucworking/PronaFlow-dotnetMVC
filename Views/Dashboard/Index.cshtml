@model dynamic

@{ 
    ViewBag.Title = ViewBag.Title ?? "Dashboard | PronaFlow";
}

<main id="main" class="main dashboard no-scrollbar">
    <div id="greeting-widget-frame" class="greeting-widget">
        <img src="~/wwwroot/images/hello.gif" alt="Hello Icon">
        <span id="greeting-widget"></span>
    </div>

    <div class="divider"></div>

    <div class="widget-group">
        <div class="widget">
            <h3 class="widget__title">Overview</h3>
            <div class="widget__content widget__content--overview">
                <div class="inner-widget-content">
                    You're managing <span id="total-projects">@ViewBag.TotalProjects</span> projects in total
                </div>
            </div>
        </div>
        <div class="widget">
            <h3 class="widget__title">Task in progress</h3>
            <div class="widget__content widget__content--inprogress">
                <div class="inner-widget-content">
                    You're working on <span id="total-tasks-inprogress">@ViewBag.TotalTasks</span> tasks right now
                </div>
            </div>
        </div>
        <div class="widget">
            <h3 class="widget__title">Task Overdue</h3>
            <div class="widget__content widget__content--overdue">
                <div class="inner-widget-content">
                    You have <span id="total-tasks-overdue">@ViewBag.TotalTasksOverdue</span> overdue tasks to catch up on
                </div>
            </div>
        </div>
    </div>

    <div class="divider"></div>

    <div class="frames">
        <div class="frame frame--dashboard">
            <h3 class="frame__title frame__title--dashboard">Upcoming task</h3>
            <div class="frame__content hide-scrollbar">
                <div class="task-list" id="upcoming-tasks">
                    @{ var tasks = ViewBag.UpcomingTasks as IEnumerable<PronaFlow_MVC.Models.ViewModels.TaskItemViewModel>; }
                    @if (tasks != null)
                    {
                        foreach (var t in tasks)
                        {
                            <div class="event-item event-item--task">
                                <div class="event-item__icon-wrapper">
                                    <label class="custom-checkbox">
                                        <input type="checkbox" />
                                        <span class="custom-checkbox__checkmark"></span>
                                    </label>
                                </div>
                                <div class="event-item__content">
                                    <div class="event-item__header">
                                        <span class="event-item__title">@t.Name</span>
                                    </div>
                                    <div class="event-item__meta">
                                        <div class="event-item__meta-group">
                                            <i data-lucide="folder-open"></i>
                                            <span>In: @t.ProjectName — @t.WorkspaceName</span>
                                        </div>
                                        @if (!string.IsNullOrEmpty(t.Priority))
                                        {
                                            <div class="event-item__meta-group">
                                                <i data-lucide="star"></i>
                                                <span>@t.Priority</span>
                                            </div>
                                        }
                                        @if (t.DueDate.HasValue)
                                        {
                                            <div class="event-item__meta-group">
                                                <i data-lucide="flag"></i>
                                                <span>Deadline: @t.DueDate.Value.ToString("MMM dd")</span>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="inner-widget-content">No upcoming tasks</div>
                    }
                </div>
            </div>
        </div>
    </div>
</main>

<script>
import { renderGreetingWidget } from "../../wwwroot/js/ui"

    document.addEventListener('DOMContentLoaded', function ()
    {
        const userName = '@ViewBag.CurrentUserName';
        renderGreetingWidget(userName);
    }
</script>