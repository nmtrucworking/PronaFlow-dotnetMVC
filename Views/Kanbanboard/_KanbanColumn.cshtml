@model dynamic
@{
    string title = Model.Title;
    string uiStatus = Model.UiStatus;
    var projects = (IEnumerable<PronaFlow_MVC.Models.ViewModels.KanbanProjectCardViewModel>)Model.Projects;
    
    var optionsPopoverId = $"kanban-col-options-{uiStatus}";
    var addPopoverId = $"kanban-add-project-{uiStatus}";
}

<div class="kanban-column kanban__col" data-status="@uiStatus">
    <div class="kanban-column__header">
        <button class="btn-icon-only btn-add-trigger" popovertarget="@addPopoverId" type="button">
            <i data-lucide="plus" class="icon-sm"></i>
        </button>
        <h3>@title</h3>
        <button class="btn icon-btn btn-kanban-col-options-@uiStatus" popovertarget="@optionsPopoverId">
            <i data-lucide="ellipsis-vertical" class="btn-icon"></i>
        </button>
    </div>
    <div class="divider"></div>
    <div class="list-card hide-scrollbar">
        @foreach (var project in projects)
        {
            @Html.Partial("_ProjectCard" , project)
        }
    </div>

    <div id="@addPopoverId" popover class="popover popover-add-project">
        <div class="popover__header">
            <span class="popover__title">New Project in @title</span>
            <button type="button" popovertarget="@addPopoverId" popovertargetaction="hide" class="btn-close-popover">
                <i data-lucide="x" class="icon-xs"></i>
            </button>
        </div>
        <div class="popover__body">
            @using (Html.BeginForm("CreateMinimal", "Project", FormMethod.Post, new { @class = "popover-form" }))
            {
                @Html.AntiForgeryToken()
                @Html.Hidden("workspaceId", (int)(ViewBag.WorkspaceId ?? ViewBag.CurrentWorkspaceId))
                @Html.Hidden("status", uiStatus)

                <div class="form-group">
                    <input type="text" name="name" class="form-input" placeholder="Project name..." required autocomplete="off" autofocus />
                </div>
                <div class="form-actions-right">
                    <button type="submit" class="btn btn--primary btn--sm">Create</button>
                </div>
            }
        </div>
    </div>

    <div popover class="popover kanban-col-options-@uiStatus" id="@optionsPopoverId">
        <div class="popover__header">
            <span class="popover__title">Column Options</span>
            <button type="button">
                <i data-lucide="x" class="icon-sm"></i>
            </button>
        </div>
        <div class="popover__body">
            <button type="button" class="popover-item add-card-in-popover">Add card</button>
            <button type="button" class="popover-item">Move all cards in this state</button>
            <button type="button" class="popover-item">
                <span>Set all cards of State to </span>
                <select>
                    <option value="temp">Temp</option>
                    <option value="not-started">Not Started</option>
                    <option value="in-progress">In Progress</option>
                    <option value="in-review">In Review</option>
                    <option value="done">Done</option>
                </select>
            </button>
            <button type="button" class="popover-item btn-danger">Remove all cards of this [state]</button>
            <button type="button" class="popover-item">Archive all cards of this [state]</button>
        </div>
    </div>
</div>