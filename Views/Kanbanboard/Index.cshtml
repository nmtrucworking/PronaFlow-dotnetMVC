@model PronaFlow_MVC.Models.ViewModels.KanbanBoardViewModel
@{
    ViewBag.Title = "Kanban Board | PronaFlow";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    string GetUiStatus(string dbStatus)
    {
        var statusMapping = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
        {
            { "temp", "temp"},
            { "notstarted", "not-started"},
            { "inprogress", "in-progress"},
            { "inreview", "in-review"},
            { "done", "done"},
        };
        return statusMapping.TryGetValue(dbStatus, out var uiStatus) ? uiStatus : "unknown-status";
    }
}
@{
    var columns = new[]
    {
        new { Title = "Temp",         UiStatus = "temp" },
        new { Title = "Not Started",  UiStatus = "not-started" },
        new { Title = "In Progress",  UiStatus = "in-progress" },
        new { Title = "In Review",    UiStatus = "in-review" },
        new { Title = "Done",         UiStatus = "done" },
    };
    var byStatus = Model.Projects.GroupBy(p => GetUiStatus(p.Status))
                                 .ToDictionary(g => g.Key, g => g.AsEnumerable());
}

<main id="main" class="main kanban-board">
    <div class="kanban-board__header">
        <div class="workspace__title">
            <span id="workspaceName">@Model.WorkspaceName</span>
        </div>
        <span id="workspaceDescription" class="workspace__description">@Model.WorkspaceDescription</span>
    </div>

    <div class="frames frames--grid-2col">
        <!---->
        <div class="frame frame--kanban">
            <!-- Render from Calendar/AgendaCalendar-->
        </div>
        <div class="frame frame--kanban">
            <h3 class="frame__title">My Tasks</h3>
            <div class="frame__content hide-scrollbar">
                @Html.Action("GetTasksPartial", "Task"), new { workspaceId = Model.CurrentWorkspaceID}
            </div>
        </div>
    </div>

    <input type="hidden" id="currentWorkspaceId" value="@Model.CurrentWorkspaceId" />
    <div id="kanban-view" class="kanban-view">
        @foreach (var col in columns)
        {
            var projects = byStatus.TryGetValue(col.UiStatus, out var list)
                ? list
                : Enumerable.Empty<PronaFlow_MVC.Models.ViewModels.KanbanProjectCardViewModel>();

            @Html.Partial("_KanbanColumn", new { Title = col.Title, UiStatus = col.UiStatus, Projects = projects, WorkspaceId = Model.CurrentWorkspaceId })
        }
    </div>

</main>

@section scripts {
    <script src="~/wwwroot/js/KanbanPageRefactored.js"></script>
    <script>
        
    </script>
}

@if (ViewBag.OpenProjectId != null)
{
    @Html.Action("DetailsPartial", "Project", new { id = (int)ViewBag.OpenProjectId })
}
