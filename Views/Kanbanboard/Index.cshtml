@model PronaFlow_MVC.Models.ViewModels.KanbanBoardViewModel
@{
    ViewBag.Title = "Kanban Board | PronaFlow";
}
@{
    string GetUiStatus(string dbStatus)
    {
        var statusMapping = new Dictionary<string, string>(StringComparer.OrdinalIgnoreCase)
        {
            { "temp", "temp"},
            { "notstarted", "not-started"},
            { "inprogress", "in-progress"},
            { "inreview", "in-review"},
            { "done", "done"},
        };
        return statusMapping.TryGetValue(dbStatus, out var uiStatus) ? uiStatus : "unknown-status";
    }
}
@{
    var columns = new[]
    {
        new { Title = "Temp",         UiStatus = "temp" },
        new { Title = "Not Started",  UiStatus = "not-started" },
        new { Title = "In Progress",  UiStatus = "in-progress" },
        new { Title = "In Review",    UiStatus = "in-review" },
        new { Title = "Done",         UiStatus = "done" },
    };
    var byStatus = Model.Projects.GroupBy(p => GetUiStatus(p.Status))
                                 .ToDictionary(g => g.Key, g => g.AsEnumerable());
}
<input type="hidden" id="currentWorkspaceId" value="@Model.CurrentWorkspaceId" />
<div id="kanban-view" class="kanban-view">
    @foreach (var col in columns)
    {
        var projects = byStatus.TryGetValue(col.UiStatus, out var list)
            ? list
            : Enumerable.Empty<PronaFlow_MVC.Models.ViewModels.KanbanProjectCardViewModel>();

        @Html.Partial("_KanbanColumn", new { Title = col.Title, UiStatus = col.UiStatus, Projects = projects })
    }
</div>

@section scripts {
    <script src="~/wwwroot/js/KanbanPageRefactored.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (window.lucide) { lucide.createIcons(); }
            initializeAddProjectButtons();
            initializeProjectCardClicks();
            initKanbanDragDrop();
        });
    </script>
}
